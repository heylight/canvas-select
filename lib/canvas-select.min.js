!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).CanvasSelect=e()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};function e(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}function i(t,e,i,a){return new(i||(i=Promise))((function(r,n){function o(t){try{c(a.next(t))}catch(t){n(t)}}function s(t){try{c(a.throw(t))}catch(t){n(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,s)}c((a=a.apply(t,e||[])).next())}))}function a(t,e){var i,a,r,n,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,a&&(r=2&n[0]?a.return:n[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,n[1])).done)return r;switch(a=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,a=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){o=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){o.label=n[1];break}if(6===n[0]&&o.label<r[1]){o.label=r[1],r=n;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(n);break}r[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],a=0}finally{i=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}function r(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,r,n=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(t){r={error:t}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(r)throw r.error}}return o}function n(t,e){for(var i=0,a=e.length,r=t.length;i<a;i++,r++)t[r]=e[i];return t}var o=function(t,e,i,a){this.label="",this.coor=[],this.strokeStyle="",this.fillStyle="",this.labelFillStyle="",this.labelFont="",this.active=!1,this.creating=!1,this.dragging=!1,this.uuid=function(){for(var t=[],e="0123456789abcdef",i=0;i<36;i++)t[i]=e.substr(Math.floor(16*Math.random()),1);return t[14]="4",t[19]=e.substr(3&t[19]|8,1),t[8]=t[13]=t[18]=t[23]="-",t.join("")}();var r=i.strokeStyle,n=i.fillStyle,o=i.labelFillStyle,s=i.labelFont;this.index=t,this.label=e,this.strokeStyle=r,this.fillStyle=n,this.labelFillStyle=o,this.labelFont=s,a&&(this.uuid=a)},s=function(t){function i(e,i,a,r,n){void 0===r&&(r={});var o=t.call(this,i,a,r,n)||this;return o.type=1,o.coor=e,o}return e(i,t),Object.defineProperty(i.prototype,"ctrlsData",{get:function(){var t=r(this.coor,2),e=r(t[0],2),i=e[0],a=e[1],n=r(t[1],2),o=n[0],s=n[1];return[[i,a],[i+(o-i)/2,a],[o,a],[o,a+(s-a)/2],[o,s],[i+(o-i)/2,s],[i,s],[i,a+(s-a)/2]]},enumerable:!1,configurable:!0}),i}(o),c=function(t){function i(e,i,a,r,n){void 0===r&&(r={});var o=t.call(this,i,a,r,n)||this;return o.type=2,o.coor=e,o}return e(i,t),Object.defineProperty(i.prototype,"ctrlsData",{get:function(){return this.coor.length>2?this.coor:[]},enumerable:!1,configurable:!0}),i}(o),l=function(t){function i(e,i,a,r,n){void 0===r&&(r={});var o=t.call(this,i,a,r,n)||this;return o.type=3,o.coor=e,o}return e(i,t),i}(o),h=function(){function t(){this._eventTree={}}return t.prototype.on=function(t,e){var i=this._eventTree[t];Array.isArray(i)?i.push(e):this._eventTree[t]=[e]},t.prototype.emit=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var a=this._eventTree[t];Array.isArray(a)&&a.forEach((function(t){return t.apply(void 0,n([],r(e)))}))},t.prototype.off=function(t,e){var i=this._eventTree[t],a=i.find((function(t){return t===e}));Array.isArray(i)&&a&&i.splice(a,1)},t}();return function(t){function n(e,i){var a=t.call(this)||this;a.lock=!1,a.MIN_WIDTH=10,a.MIN_HEIGHT=10,a.strokeStyle="rgb(0, 0, 255)",a.fillStyle="rgba(0, 0, 255,0.1)",a.activeStrokeStyle="#f00",a.activeFillStyle="rgba(255, 0, 0,0.1)",a.ctrlStrokeStyle="#000",a.ctrlFillStyle="#fff",a.ctrlRadius=3,a.labelFillStyle="#fff",a.labelFont="12px serif #000",a.labelMaxLen=5,a.dataset=[],a.remmberOrigin=[0,0],a.createType=0,a.ctrlIndex=-1,a.cursor="auto",a.image=new Image,a.originX=0,a.originY=0,a.scaleStep=0;var r="string"==typeof e?document.querySelector(e):e;return Object.prototype.toString.call(r).includes("HTMLCanvasElement")?(a.canvas=r,a.ctx=a.canvas.getContext("2d"),a.WIDTH=a.canvas.clientWidth,a.HEIGHT=a.canvas.clientHeight,a.offlineCanvas=document.createElement("canvas"),a.offlineCanvas.width=a.WIDTH,a.offlineCanvas.height=a.HEIGHT,a.offlineCtx=a.offlineCanvas.getContext("2d"),a.initScreen(),i&&a.setImage(i)):console.warn("HTMLCanvasElement is required!"),a}return e(n,t),Object.defineProperty(n.prototype,"activeShape",{get:function(){return this.dataset.find((function(t){return t.active}))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"scale",{get:function(){return this.IMAGE_ORIGIN_WIDTH&&this.IMAGE_WIDTH?this.IMAGE_WIDTH/this.IMAGE_ORIGIN_WIDTH:1},enumerable:!1,configurable:!0}),n.prototype.initScreen=function(){var t=this;this.canvas.style.userSelect="none",this.canStart=new Promise((function(e){t.imageLoaded?e(!0):t.image.addEventListener("load",(function(){t.emit("load"),t.IMAGE_ORIGIN_WIDTH=t.IMAGE_WIDTH=t.image.width,t.IMAGE_ORIGIN_HEIGHT=t.IMAGE_HEIGHT=t.image.height,t.fitZoom(),e(!0)}))})),this.canvas.addEventListener("contextmenu",(function(e){t.lock||e.preventDefault()})),this.canvas.addEventListener("mousewheel",(function(e){if(!t.lock){e.preventDefault(),t.setScale(e.deltaY<0);var i=Math.round(e.offsetX/t.scale),a=Math.round(e.offsetY/t.scale);t.movePoint=[i,a],t.update()}})),this.canvas.addEventListener("mousedown",(function(e){var i,a;if(!t.lock){var n=Math.round(e.offsetX/t.scale),o=Math.round(e.offsetY/t.scale),h=[e.offsetX,e.offsetY];if(2===e.buttons)t.remmberOrigin=[e.offsetX-t.originX,e.offsetY-t.originY];else if(1===e.buttons){var u=(null===(i=t.activeShape)||void 0===i?void 0:i.ctrlsData)||[];if(t.ctrlIndex=u.findIndex((function(e){return t.isPointInCircle(h,e,t.ctrlRadius)})),t.ctrlIndex>-1){var f=r(u[t.ctrlIndex],2),p=f[0],d=f[1];return void(t.remmber=[[n-p,o-d]])}var v=r(t.hitOnShape(h),2),I=v[0],y=v[1];if(2===(null===(a=t.activeShape)||void 0===a?void 0:a.type)&&t.activeShape.creating){if(t.isInBackground(e)){var g=t.activeShape,S=r(g.coor[g.coor.length-1],2),b=S[0],H=S[1];if(b!==n&&H!==o){var m=Math.round(n-t.originX/t.scale),T=Math.round(o-t.originY/t.scale);g.coor.push([m,T]),t.update()}}}else if(I>-1){if(t.emit("select",y),t.dataset.forEach((function(t,e){t.active=e===I})),y.dragging=!0,t.dataset.splice(I,1),t.dataset.push(y),t.remmber=[],3===y.type){var x=r(y.coor,2);b=x[0],H=x[1];t.remmber=[[n-b,o-H]]}else y.coor.forEach((function(e){t.remmber.push([n-e[0],o-e[1]])}));t.update()}else if(t.createType>0&&t.isInBackground(e)){var E=void 0,M=[m=Math.round(n-t.originX/t.scale),T=Math.round(o-t.originY/t.scale)];1===t.createType?(E=new s([M,M],t.dataset.length)).creating=!0:2===t.createType?(E=new c([M],t.dataset.length)).creating=!0:3===t.createType&&(E=new l(M,t.dataset.length),t.emit("add",E)),t.dataset.forEach((function(t){t.active=!1})),E.active=!0,t.dataset.push(E),t.emit("updated",E),t.update()}else t.activeShape&&(t.activeShape.active=!1,t.update())}}})),this.canvas.addEventListener("mousemove",(function(e){var i,a;if(!t.lock){var n=Math.round(e.offsetX/t.scale),o=Math.round(e.offsetY/t.scale);if(t.movePoint=[n,o],2===e.buttons&&3===e.which)t.originX=Math.round(e.offsetX-t.remmberOrigin[0]),t.originY=Math.round(e.offsetY-t.remmberOrigin[1]),t.update();else if(1===e.buttons&&t.activeShape){if(t.ctrlIndex>-1&&t.isInBackground(e)){var s=r(t.remmber,1),c=r(s[0],2),l=c[0],h=c[1];if(1===t.activeShape.type){var u=r(t.activeShape.coor,2),f=r(u[0],2),p=f[0],d=f[1],v=r(u[1],2),I=v[0],y=v[1],g=[];switch(t.ctrlIndex){case 0:g=[[n-l,o-h],[I,y]];break;case 1:g=[[p,o-h],[I,y]];break;case 2:g=[[p,o-h],[n-l,y]];break;case 3:g=[[p,d],[n-l,y]];break;case 4:g=[[p,d],[n-l,o-h]];break;case 5:g=[[p,d],[I,o-h]];break;case 6:g=[[n-l,d],[I,o-h]];break;case 7:g=[[n-l,d],[I,y]]}var S=r(g,2),b=r(S[0],2),H=b[0],m=b[1],T=r(S[1],2),x=T[0],E=T[1];x-H>=t.MIN_WIDTH&&E-m>=t.MIN_HEIGHT?t.activeShape.coor=g:t.emit("error","宽不能小于".concat(t.MIN_WIDTH,",高不能小于").concat(t.MIN_HEIGHT,"。"))}else if(2===t.activeShape.type){var M=[Math.round(n-t.originX/t.scale),Math.round(o-t.originY/t.scale)];t.activeShape.coor.splice(t.ctrlIndex,1,M)}}else if(t.activeShape.dragging){g=[];var G=!0,_=t.IMAGE_ORIGIN_WIDTH||t.WIDTH,k=t.IMAGE_ORIGIN_HEIGHT||t.HEIGHT;if(3===t.activeShape.type){var w=r(t.remmber[0],2),D=w[0];h=o-w[1];((l=n-D)<0||l>_||h<0||h>k)&&(G=!1),g=[l,h]}else for(var A=0;A<t.activeShape.coor.length;A++){var W=t.remmber[A];l=n-W[0],h=o-W[1];(l<0||l>_||h<0||h>k)&&(G=!1),g.push([l,h])}G&&(t.activeShape.coor=g)}else if(t.activeShape.creating&&1===t.activeShape.type&&t.isInBackground(e)){l=Math.round(n-t.originX/t.scale),h=Math.round(o-t.originY/t.scale);t.activeShape.coor.splice(1,1,[l,h])}t.emit("updated",t.activeShape),t.update()}else 2===(null===(i=t.activeShape)||void 0===i?void 0:i.type)&&(null===(a=t.activeShape)||void 0===a?void 0:a.creating)&&t.update()}})),this.canvas.addEventListener("mouseup",(function(e){if(!t.lock&&(t.remmber=[],t.activeShape&&(t.activeShape.dragging=!1,t.activeShape.creating&&1===t.activeShape.type))){var i=r(t.activeShape.coor,2),a=r(i[0],2),n=a[0],o=a[1],s=r(i[1],2),c=s[0],l=s[1];Math.abs(n-c)<t.MIN_WIDTH||Math.abs(o-l)<t.MIN_HEIGHT?(t.dataset.pop(),t.emit("error","宽不能小于".concat(t.MIN_WIDTH,",高不能小于").concat(t.MIN_HEIGHT))):(t.activeShape.coor=[[Math.min(n,c),Math.min(o,l)],[Math.max(n,c),Math.max(o,l)]],t.activeShape.creating=!1,t.emit("add",t.activeShape)),t.update()}})),this.canvas.addEventListener("dblclick",(function(){var e;t.lock||2===(null===(e=t.activeShape)||void 0===e?void 0:e.type)&&t.activeShape.coor.length>2&&(t.emit("add",t.activeShape),t.emit("updated",t.activeShape),t.activeShape.creating=!1,t.update())})),document.body.addEventListener("keyup",(function(e){t.lock||t.activeShape&&(2===t.activeShape.type&&"Escape"===e.key?(t.activeShape.coor.length>1&&t.activeShape.creating?t.activeShape.coor.pop():t.deleteByIndex(t.activeShape.index),t.update()):"Backspace"===e.key&&t.deleteByIndex(t.activeShape.index))}))},n.prototype.setImage=function(t){this.imageLoaded=!1,this.image.src=t},n.prototype.setData=function(t){return i(this,void 0,void 0,(function(){var e,i,r=this;return a(this,(function(a){switch(a.label){case 0:e=[],a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this.canStart];case 2:return a.sent(),t.forEach((function(t,i){if(Object.prototype.toString.call(t).indexOf("Object")>-1){var a=t.label,n=t.type,o=t.coor,h=t.strokeStyle,u=t.fillStyle,f=t.labelFillStyle,p=t.labelFont,d=t.uuid,v={strokeStyle:h,fillStyle:u,labelFillStyle:f,labelFont:p},I=void 0;switch(n){case 1:I=new s(o,i,a,v,d);break;case 2:I=new c(o,i,a,v,d);break;case 3:I=new l(o,i,a,v,d)}e.push(I)}else r.emit("error","".concat(t," in data must be an enumerable Object."))})),this.dataset=e,this.update(),[3,4];case 3:return i=a.sent(),this.emit("error",i),[3,4];case 4:return[2]}}))}))},n.prototype.hitOnShape=function(t){var e=this,i=-1,a=this.dataset.reduceRight((function(a,r,n){return a||(3===r.type&&e.isPointInCircle(t,r.coor,3)||1===r.type&&e.isPointInRect(t,r.coor)||2===r.type&&e.isPointInPolygon(t,r.coor))&&(i=n,a=r),a}),null);return[i,a]},n.prototype.isInBackground=function(t){var e=t.offsetX/this.scale,i=t.offsetY/this.scale;return e>=this.originX/this.scale&&i>=this.originY/this.scale&&e<=this.originX/this.scale+this.IMAGE_ORIGIN_WIDTH&&i<=this.originY/this.scale+this.IMAGE_ORIGIN_HEIGHT},n.prototype.isPointInRect=function(t,e){var i=this,a=r(t,2),n=a[0],o=a[1],s=r(e.map((function(t){return t.map((function(t){return t*i.scale}))})),2),c=r(s[0],2),l=c[0],h=c[1],u=r(s[1],2),f=u[0],p=u[1];return l+this.originX<=n&&n<=f+this.originX&&h+this.originY<=o&&o<=p+this.originY},n.prototype.isPointInPolygon=function(t,e){var i=this;this.offlineCtx.save(),this.offlineCtx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.offlineCtx.translate(this.originX,this.originY),this.offlineCtx.beginPath(),e.forEach((function(t,e){var a=r(t.map((function(t){return Math.round(t*i.scale)})),2),n=a[0],o=a[1];0===e?i.offlineCtx.moveTo(n,o):i.offlineCtx.lineTo(n,o)})),this.offlineCtx.closePath(),this.offlineCtx.fill();var a=this.offlineCtx.getImageData(0,0,this.WIDTH,this.HEIGHT),n=(t[1]-1)*this.WIDTH*4+4*t[0];return this.offlineCtx.restore(),0!==a.data[n+3]},n.prototype.isPointInCircle=function(t,e,i){var a=this,n=r(t,2),o=n[0],s=n[1],c=r(e.map((function(t){return t*a.scale})),2),l=c[0],h=c[1];return Math.sqrt(Math.pow(l+this.originX-o,2)+Math.pow(h+this.originY-s,2))<=i},n.prototype.drawRect=function(t){var e=this;if(2===t.coor.length){var i=t.labelFillStyle,a=t.labelFont,n=t.strokeStyle,o=t.fillStyle,s=t.active,c=t.creating,l=t.coor,h=t.label,u=r(l.map((function(t){return t.map((function(t){return Math.round(t*e.scale)}))})),2),f=r(u[0],2),p=f[0],d=f[1],v=r(u[1],2),I=v[0],y=v[1];this.ctx.save(),this.ctx.fillStyle=o||this.fillStyle,this.ctx.strokeStyle=s||c?this.activeStrokeStyle:n||this.strokeStyle;var g=I-p,S=y-d;this.ctx.strokeRect(p,d,g,S),c||this.ctx.fillRect(p,d,g,S),this.ctx.restore(),this.drawLabel(l[0],h,i,a)}},n.prototype.drawPolygon=function(t){var e=this,i=t.labelFillStyle,a=t.labelFont,n=t.strokeStyle,o=t.fillStyle,s=t.active,c=t.creating,l=t.coor,h=t.label;if(this.ctx.save(),this.ctx.fillStyle=o||this.fillStyle,this.ctx.strokeStyle=s||c?this.activeStrokeStyle:n||this.strokeStyle,this.ctx.beginPath(),l.forEach((function(t,i){var a=r(t.map((function(t){return Math.round(t*e.scale)})),2),n=a[0],o=a[1];0===i?e.ctx.moveTo(n,o):e.ctx.lineTo(n,o)})),c){var u=r(this.movePoint.map((function(t){return Math.round(t*e.scale)})),2),f=u[0],p=u[1];this.ctx.lineTo(f-this.originX,p-this.originY)}else l.length>2&&this.ctx.closePath();this.ctx.fill(),this.ctx.stroke(),this.ctx.restore(),this.drawLabel(l[0],h,i,a)},n.prototype.drawDot=function(t){var e=this,i=t.labelFillStyle,a=t.labelFont,n=t.strokeStyle,o=t.fillStyle,s=t.active,c=t.coor,l=t.label,h=r(c.map((function(t){return t*e.scale})),2),u=h[0],f=h[1];this.ctx.save(),this.ctx.fillStyle=o||this.ctrlFillStyle,this.ctx.strokeStyle=s?this.activeStrokeStyle:n||this.strokeStyle,this.ctx.beginPath(),this.ctx.arc(u,f,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.arc(u,f,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.restore(),this.drawLabel(c,l,i,a)},n.prototype.drawCtrl=function(t){var e=this,i=r(t.map((function(t){return t*e.scale})),2),a=i[0],n=i[1];this.ctx.save(),this.ctx.beginPath(),this.ctx.fillStyle=this.ctrlFillStyle,this.ctx.strokeStyle=this.ctrlStrokeStyle,this.ctx.arc(a,n,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.arc(a,n,this.ctrlRadius,0,2*Math.PI,!0),this.ctx.stroke(),this.ctx.restore()},n.prototype.drawCtrlList=function(t){var e=this;t.ctrlsData.forEach((function(t){e.drawCtrl(t)}))},n.prototype.drawLabel=function(t,e,i,a){var n=this;if(void 0===e&&(e=""),void 0===i&&(i=""),void 0===a&&(a=""),e.length){var o=e.length<this.labelMaxLen+1?e:"".concat(e.substr(0,this.labelMaxLen),"..."),s=this.ctx.measureText(o),c=r(t.map((function(t){return t*n.scale})),2),l=c[0],h=c[1],u=this.IMAGE_ORIGIN_WIDTH-t[0]<(s.width+4)/this.scale,f=this.IMAGE_ORIGIN_HEIGHT-t[1]<16/this.scale;this.ctx.save(),this.ctx.fillStyle=i||this.labelFillStyle,this.ctx.fillRect(u?l-s.width-3:l+1,f?h-15:h+1,s.width+4,16),this.ctx.font=a||this.labelFont,this.ctx.strokeText(o,u?l-s.width-2:l+2,f?h-4:h+12,80),this.ctx.restore()}},n.prototype.paintImage=function(){this.ctx.drawImage(this.image,0,0,this.IMAGE_WIDTH,this.IMAGE_HEIGHT)},n.prototype.clear=function(){this.ctx.clearRect(0,0,this.WIDTH,this.HEIGHT)},n.prototype.update=function(){var t=this;this.ctx.save(),this.clear(),this.ctx.translate(this.originX,this.originY),this.paintImage(),this.dataset.forEach((function(e){switch(e.type){case 1:t.drawRect(e);break;case 2:t.drawPolygon(e);break;case 3:t.drawDot(e)}})),this.activeShape&&[1,2].includes(this.activeShape.type)&&this.drawCtrlList(this.activeShape),this.ctx.restore()},n.prototype.deleteByIndex=function(t){var e=this.dataset.findIndex((function(e){return e.index===t}));e>-1&&(this.emit("delete",this.dataset[e]),this.dataset.splice(e,1),this.dataset.forEach((function(t,e){t.index=e})),this.update())},n.prototype.calcStep=function(t){t&&(this.scaleStep=100,this.setScale(!1)),(this.IMAGE_WIDTH>this.WIDTH||this.IMAGE_HEIGHT>this.HEIGHT)&&(this.setScale(!1),this.calcStep())},n.prototype.setScale=function(t){if(!this.lock&&!(!t&&this.IMAGE_WIDTH<=20||t&&this.IMAGE_WIDTH>=100*this.WIDTH)){t?this.scaleStep++:this.scaleStep--;var e=Math.abs(this.scaleStep),i=this.IMAGE_WIDTH;this.IMAGE_WIDTH=Math.round(this.IMAGE_ORIGIN_WIDTH*Math.pow(this.scaleStep>=0?1.05:.95,e)),this.IMAGE_HEIGHT=Math.round(this.IMAGE_ORIGIN_HEIGHT*Math.pow(this.scaleStep>=0?1.05:.95,e)),this.stayPosition(this.IMAGE_WIDTH/i),this.update()}},n.prototype.fitZoom=function(){this.calcStep(!0),this.IMAGE_HEIGHT/this.IMAGE_WIDTH>=this.HEIGHT/this.WIDTH?(this.IMAGE_WIDTH=this.IMAGE_ORIGIN_WIDTH/(this.IMAGE_ORIGIN_HEIGHT/this.HEIGHT),this.IMAGE_HEIGHT=this.HEIGHT):(this.IMAGE_WIDTH=this.WIDTH,this.IMAGE_HEIGHT=this.IMAGE_ORIGIN_HEIGHT/(this.IMAGE_ORIGIN_WIDTH/this.WIDTH)),this.originX=(this.WIDTH-this.IMAGE_WIDTH)/2,this.originY=(this.HEIGHT-this.IMAGE_HEIGHT)/2,this.update()},n.prototype.stayPosition=function(t){this.originX=this.WIDTH/2-(this.WIDTH/2-this.originX)*t,this.originY=this.HEIGHT/2-(this.HEIGHT/2-this.originY)*t},n}(h)}));
//# sourceMappingURL=canvas-select.min.js.map
