<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <title>Canvas-Select åŠŸèƒ½æ¼”ç¤º</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      margin-bottom: 10px;
      font-size: 2.5em;
    }

    .header p {
      opacity: 0.9;
      font-size: 1.1em;
    }

    .main-container {
      display: flex;
      gap: 20px;
      padding: 20px;
      max-width: 1600px;
      margin: 0 auto;
    }

    .left-sidebar {
      width: 300px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .content-area {
      flex: 1;
      display: flex;
      gap: 20px;
    }

    .canvas-section {
      flex: 1;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .canvas-container {
      position: relative;
      background: #f8f9fa;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .canvas-container canvas {
      display: block;
      width: 100%;
      height: 500px;
      /* cursor: crosshair; */
    }

    .controls-section {
      width: 350px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      max-height: calc(100vh - 140px);
      overflow-y: auto;
    }

    .control-group {
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
    }

    .control-group:last-child {
      border-bottom: none;
    }

    .control-group h3 {
      color: #495057;
      margin-bottom: 15px;
      font-size: 1.1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .control-group h3::before {
      content: '';
      width: 4px;
      height: 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 2px;
    }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 8px;
      margin-bottom: 15px;
    }

    .btn {
      padding: 10px 12px;
      border: 2px solid #e9ecef;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 12px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
      transform: translateY(-1px);
    }

    .btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn.danger {
      border-color: #dc3545;
      color: #dc3545;
    }

    .btn.danger:hover {
      background: #dc3545;
      color: white;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 15px;
    }

    .input-group label {
      font-size: 13px;
      font-weight: 500;
      color: #495057;
    }

    .input-group input,
    .input-group select {
      padding: 8px 12px;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.2s ease;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .color-input {
      width: 50px;
      height: 35px;
      padding: 2px;
      border-radius: 6px;
      cursor: pointer;
    }

    .range-input {
      width: 100%;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    .checkbox-group input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .data-section {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }

    .data-section h4 {
      margin-bottom: 10px;
      color: #495057;
    }

    .data-output {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .event-log {
      background: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 6px;
      padding: 10px;
      margin-top: 10px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 12px;
    }

    .event-item {
      padding: 4px 0;
      border-bottom: 1px solid #ffeaa7;
      word-break: break-all;
    }

    .event-item:last-child {
      border-bottom: none;
    }

    .status-bar {
      background: #343a40;
      color: white;
      padding: 15px;
      border-radius: 12px;
      font-size: 13px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      padding: 4px 0;
    }

    .status-item:last-child {
      margin-bottom: 0;
    }

    .help-section {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    .help-section h4 {
      color: #1976d2;
      margin-bottom: 10px;
    }

    .help-section ul {
      list-style: none;
      padding-left: 0;
    }

    .help-section li {
      padding: 4px 0;
      font-size: 13px;
      color: #424242;
    }

    .help-section li::before {
      content: 'ğŸ’¡';
      margin-right: 8px;
    }

    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
        padding: 10px;
      }

      .left-sidebar {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
      }

      .status-bar {
        min-width: 300px;
      }

      .help-section {
        min-width: 300px;
      }

      .content-area {
        flex-direction: column;
      }

      .controls-section {
        width: 100%;
        max-height: none;
      }

      .button-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .header h1 {
        font-size: 2em;
      }
    }

    @media (max-width: 768px) {
      .left-sidebar {
        flex-direction: column;
      }

      .status-bar,
      .help-section {
        min-width: auto;
      }
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #28a745;
      color: white;
      padding: 12px 20px;
      border-radius: 6px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transform: translateX(400px);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.error {
      background: #dc3545;
    }

    .toast.warning {
      background: #ffc107;
      color: #212529;
    }
  </style>
</head>

<body>
  <div class="header">
    <h3>Canvas-Select å®Œæ•´åŠŸèƒ½æ¼”ç¤º</h3>
  </div>
  <div class="main-container">
    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-area">
      <!-- å·¦ä¾§è¾¹æ  -->
      <div class="left-sidebar">
        <!-- çŠ¶æ€æ  -->
        <div class="status-bar">
          <div class="status-item">
            <span>ğŸ“ é¼ æ ‡ä½ç½®:</span>
            <span id="mousePos">0, 0</span>
          </div>
          <div class="status-item">
            <span>ğŸ“ åæ ‡ä½ç½®:</span>
            <span id="mousePos2">0, 0</span>
          </div>
          <div class="status-item">
            <span>ğŸ“ ç¼©æ”¾æ¯”ä¾‹:</span>
            <span id="scaleInfo">100%</span>
          </div>
          <div class="status-item">
            <span>ğŸ“Š æ ‡æ³¨æ•°é‡:</span>
            <span id="shapeCount">0</span>
          </div>
          <div class="status-item">
            <span>ğŸ¯ å½“å‰æ¨¡å¼:</span>
            <span id="currentMode">é€‰æ‹©æ¨¡å¼</span>
          </div>
        </div>

        <!-- å¸®åŠ©ä¿¡æ¯ -->
        <div class="help-section">
          <h4>ğŸ’¡ æ“ä½œæç¤º</h4>
          <ul>
            <li><strong>çŸ©å½¢:</strong> æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨åˆ›å»º</li>
            <li><strong>å¤šè¾¹å½¢:</strong> å·¦é”®ç‚¹å‡»æ·»åŠ ç‚¹ï¼Œç‚¹å‡»èµ·å§‹ç‚¹é—­åˆï¼ŒESCé€€å‡ºï¼ŒBackspaceåˆ é™¤ä¸Šä¸€ç‚¹</li>
            <li><strong>ç‚¹æ ‡æ³¨:</strong> å·¦é”®å•å‡»åˆ›å»º</li>
            <li><strong>æŠ˜çº¿:</strong> å·¦é”®ç‚¹å‡»æ·»åŠ ç‚¹ï¼ŒåŒå‡»å®Œæˆï¼ŒESCé€€å‡º</li>
            <li><strong>åœ†å½¢:</strong> æŒ‰ä½å·¦é”®æ‹–åŠ¨ç¡®å®šåŠå¾„</li>
            <li><strong>ç½‘æ ¼:</strong> å³é”®è®¾ç½®è¡Œåˆ—æ•°ï¼ŒåŒå‡»å•å…ƒæ ¼é€‰ä¸­/å–æ¶ˆ</li>
            <li><strong>ç”»ç¬”:</strong> æŒ‰ä½å·¦é”®æ‹–åŠ¨ç»˜åˆ¶</li>
            <li><strong>æ©¡çš®æ“¦:</strong> æŒ‰ä½å·¦é”®æ‹–åŠ¨æ“¦é™¤</li>
            <li><strong>ç”»å¸ƒæ“ä½œ:</strong> å³é”®æ‹–åŠ¨ç”»å¸ƒï¼Œæ»šè½®ç¼©æ”¾ï¼ŒBackspaceåˆ é™¤é€‰ä¸­å½¢çŠ¶</li>
          </ul>
        </div>
      </div>
      <div class="canvas-section">
        <div class="canvas-container">
          <canvas class="canvas"></canvas>
        </div>

        <div class="data-section">
          <h4>ğŸ“Š æ ‡æ³¨æ•°æ®è¾“å‡º</h4>
          <div class="data-output" id="dataOutput">ç­‰å¾…æ ‡æ³¨æ•°æ®...</div>

          <h4 style="margin-top: 15px;">ğŸ“ äº‹ä»¶æ—¥å¿—</h4>
          <div class="event-log" id="eventLog">
            <div class="event-item">ç³»ç»Ÿå·²åˆå§‹åŒ–ï¼Œç­‰å¾…æ“ä½œ...</div>
          </div>
        </div>
      </div>

      <div class="controls-section">
        <!-- åˆ›å»ºå·¥å…· -->
        <div class="control-group">
          <h3>ğŸ¨ åˆ›å»ºå·¥å…·</h3>
          <div class="button-grid">
            <button class="btn" onclick="setCreateType(0)" id="btn-0">é€‰æ‹©æ¨¡å¼</button>
            <button class="btn" onclick="setCreateType(1)" id="btn-1">çŸ©å½¢</button>
            <button class="btn" onclick="setCreateType(2)" id="btn-2">å¤šè¾¹å½¢</button>
            <button class="btn" onclick="setCreateType(3)" id="btn-3">ç‚¹æ ‡æ³¨</button>
            <button class="btn" onclick="setCreateType(4)" id="btn-4">æŠ˜çº¿</button>
            <button class="btn" onclick="setCreateType(5)" id="btn-5">åœ†å½¢</button>
            <button class="btn" onclick="setCreateType(6)" id="btn-6">ç½‘æ ¼</button>
            <button class="btn" onclick="setCreateType(7)" id="btn-7">ç”»ç¬”</button>
            <button class="btn" onclick="setCreateType(8)" id="btn-8">æ©¡çš®æ“¦</button>
          </div>
        </div>

        <!-- è§†å›¾æ§åˆ¶ -->
        <div class="control-group">
          <h3>ğŸ” è§†å›¾æ§åˆ¶</h3>
          <div class="button-grid">
            <button class="btn" onclick="zoomIn()">æ”¾å¤§</button>
            <button class="btn" onclick="zoomOut()">ç¼©å°</button>
            <button class="btn" onclick="fitZoom()">é€‚é…ç”»å¸ƒ</button>
            <button class="btn" onclick="toggleFocusMode()">ä¸“æ³¨æ¨¡å¼</button>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="showCross" onchange="toggleCross()">
            <label for="showCross">æ˜¾ç¤ºåå­—åæ ‡çº¿</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="scrollZoom" checked onchange="toggleScrollZoom()">
            <label for="scrollZoom">é¼ æ ‡æ»šè½®ç¼©æ”¾</label>
          </div>
        </div>

        <!-- æ¨¡å¼è®¾ç½® -->
        <div class="control-group">
          <h3>âš™ï¸ æ¨¡å¼è®¾ç½®</h3>
          <div class="checkbox-group">
            <input type="checkbox" id="readonly" onchange="toggleReadonly()">
            <label for="readonly">åªè¯»æ¨¡å¼</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="lock" onchange="toggleLock()">
            <label for="lock">é”å®šç”»å¸ƒ</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="showRotation" onchange="toggleShowRotation()">
            <label for="showRotation">çŸ©å½¢æ—‹è½¬æ§åˆ¶</label>
          </div>
        </div>

        <!-- æ ·å¼è®¾ç½® -->
        <div class="control-group">
          <h3>ğŸ¨ æ ·å¼è®¾ç½®</h3>
          <div class="input-group">
            <label>è¾¹æ¡†é¢œè‰²</label>
            <input type="color" class="color-input" id="strokeStyle" value="#00ff00" onchange="updateStyle()">
          </div>

          <div class="input-group">
            <label>å¡«å……é¢œè‰²</label>
            <input type="color" class="color-input" id="fillStyle" value="#0000ff" onchange="updateStyle()">
          </div>

          <div class="input-group">
            <label>è¾¹æ¡†å®½åº¦: <span id="lineWidthValue">1</span></label>
            <input type="range" class="range-input" id="lineWidth" min="1" max="10" value="1" onchange="updateStyle()">
          </div>

          <div class="input-group">
            <label>æ§åˆ¶ç‚¹å¤§å°: <span id="ctrlRadiusValue">3</span></label>
            <input type="range" class="range-input" id="ctrlRadius" min="2" max="10" value="3" onchange="updateStyle()">
          </div>
        </div>

        <!-- ç”»ç¬”è®¾ç½® -->
        <div class="control-group">
          <h3>ğŸ–Œï¸ ç”»ç¬”è®¾ç½®</h3>
          <div class="input-group">
            <label>ç”»ç¬”é¢œè‰²</label>
            <input type="color" class="color-input" id="brushColor" value="#ff0000" onchange="updateBrushStyle()">
          </div>

          <div class="input-group">
            <label>ç”»ç¬”å¤§å°: <span id="brushSizeValue">20</span></label>
            <input type="range" class="range-input" id="brushSize" min="1" max="50" value="20"
              onchange="updateBrushStyle()">
          </div>

          <div class="input-group">
            <label>æ©¡çš®æ“¦å¤§å°: <span id="eraserSizeValue">20</span></label>
            <input type="range" class="range-input" id="eraserSize" min="5" max="100" value="20"
              onchange="updateEraserStyle()">
          </div>
        </div>

        <!-- æ ‡ç­¾è®¾ç½® -->
        <div class="control-group">
          <h3>ğŸ·ï¸ æ ‡ç­¾è®¾ç½®</h3>
          <div class="input-group">
            <label>æ ‡ç­¾å­—ä½“</label>
            <select id="labelFont" onchange="updateLabelStyle()">
              <option value="10px sans-serif">10px é»˜è®¤å­—ä½“</option>
              <option value="12px sans-serif">12px é»˜è®¤å­—ä½“</option>
              <option value="14px sans-serif">14px é»˜è®¤å­—ä½“</option>
              <option value="10px Arial">10px Arial</option>
              <option value="12px Arial">12px Arial</option>
            </select>
          </div>

          <div class="input-group">
            <label>æ ‡ç­¾èƒŒæ™¯è‰²</label>
            <input type="color" class="color-input" id="labelFillStyle" value="#ffffff" onchange="updateLabelStyle()">
          </div>

          <div class="input-group">
            <label>æ ‡ç­¾æ–‡å­—é¢œè‰²</label>
            <input type="color" class="color-input" id="textFillStyle" value="#000000" onchange="updateLabelStyle()">
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="hideLabel" onchange="updateLabelStyle()">
            <label for="hideLabel">éšè—æ ‡ç­¾</label>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="labelUp" onchange="updateLabelStyle()">
            <label for="labelUp">æ ‡ç­¾æ˜¾ç¤ºåœ¨ä¸Šæ–¹</label>
          </div>
        </div>

        <!-- æ•°æ®æ“ä½œ -->
        <div class="control-group">
          <h3>ğŸ’¾ æ•°æ®æ“ä½œ</h3>
          <div class="button-grid">
            <button class="btn" onclick="loadSampleData()">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
            <button class="btn" onclick="clearAllData()">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <button class="btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            <button class="btn" onclick="importData()">å¯¼å…¥æ•°æ®</button>
          </div>

          <div class="button-grid">
            <button class="btn danger" onclick="deleteSelected()">åˆ é™¤é€‰ä¸­</button>
            <button class="btn" onclick="clearBrush()">æ¸…é™¤ç”»ç¬”</button>
          </div>
        </div>

        <!-- å›¾ç‰‡æ“ä½œ -->
        <div class="control-group">
          <h3>ğŸ–¼ï¸ å›¾ç‰‡æ“ä½œ</h3>
          <div class="input-group">
            <label>å›¾ç‰‡URL</label>
            <input type="text" id="imageUrl" placeholder="è¾“å…¥å›¾ç‰‡URL"
              value="https://n.sinaimg.cn/www/transform/300/w660h440/20240318/3875-37fb8533570d8661d3f547c7e3b0ddde.jpg">
          </div>
          <div class="button-grid">
            <button class="btn" onclick="changeImage()">æ›´æ¢å›¾ç‰‡</button>
            <button class="btn" onclick="loadLocalImage()">æœ¬åœ°å›¾ç‰‡</button>
          </div>
          <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
        </div>
      </div>
    </div>

    <script src="./lib/canvas-select.min.js"></script>
    <script>
      // å…¨å±€å˜é‡
      let instance;
      let eventLog = [];
      const maxLogItems = 50;

      // åˆå§‹åŒ–
      function init() {
        const canvas = document.querySelector('.canvas');
        canvas.addEventListener('mousewheel', (e) => {
          console.log(e.wheelDelta);
          e.preventDefault();
        });
        instance = new CanvasSelect(canvas, document.getElementById('imageUrl').value);
        window.instance = instance;

        // è®¾ç½®åˆå§‹å±æ€§
        instance.ctrlRadius = navigator.userAgent.includes('Mobile') ? 6 : 3;
        instance.createType = 0;

        // ç»‘å®šäº‹ä»¶ç›‘å¬
        setupEventListeners();

        // æ›´æ–°UIçŠ¶æ€
        updateUI();

        showToast('Canvas-Select åˆå§‹åŒ–å®Œæˆï¼', 'success');
      }

      // è®¾ç½®äº‹ä»¶ç›‘å¬
      function setupEventListeners() {
        // å›¾ç‰‡åŠ è½½å®Œæˆ
        instance.on('load', (src) => {
          addEventLog('å›¾ç‰‡åŠ è½½å®Œæˆ', { src });
          updateUI();
        });

        // è­¦å‘Šä¿¡æ¯
        instance.on('warn', (msg) => {
          addEventLog('è­¦å‘Š', { message: msg });
          showToast(msg, 'warning');
        });

        // æ·»åŠ æ ‡æ³¨
        instance.on('add', (info) => {
          addEventLog('æ·»åŠ æ ‡æ³¨', {
            type: getShapeTypeName(info.type),
            label: info.label || 'æ— æ ‡ç­¾',
            uuid: info.uuid
          });
          updateUI();
        });

        // åˆ é™¤æ ‡æ³¨
        instance.on('delete', (info) => {
          addEventLog('åˆ é™¤æ ‡æ³¨', {
            type: getShapeTypeName(info.type),
            label: info.label || 'æ— æ ‡ç­¾',
            uuid: info.uuid
          });
          updateUI();
        });

        // é€‰ä¸­æ ‡æ³¨
        instance.on('select', (info) => {
          if (info) {
            addEventLog('é€‰ä¸­æ ‡æ³¨', {
              type: getShapeTypeName(info.type),
              label: info.label || 'æ— æ ‡ç­¾',
              uuid: info.uuid
            });
          } else {
            addEventLog('å–æ¶ˆé€‰ä¸­', {});
          }
          updateUI();
        });

        // æ•°æ®æ›´æ–°
        instance.on('updated', (result) => {
          updateDataOutput(result);
          updateShapeCount(result.length);
          updateScaleInfo();
        });

        // å³é”®èœå•
        instance.on('contextmenu', (e) => {
          addEventLog('å³é”®', instance.mouse);
        });

        instance.on('coor', (s) => {
          console.log('coor', s);
        });

        // ç›‘å¬é¼ æ ‡ç§»åŠ¨æ˜¾ç¤ºåæ ‡
        const canvas = document.querySelector('.canvas');
        canvas.addEventListener('mousemove', (e) => {
          document.getElementById('mousePos').textContent = `${instance.mouse[0]}, ${instance.mouse[0]}`;
          document.getElementById('mousePos2').textContent = `${instance.position[0]}, ${instance.position[1]}`;
        });

      }

      // è®¾ç½®åˆ›å»ºç±»å‹
      function setCreateType(type) {
        instance.createType = type;

        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.btn[id^="btn-"]').forEach(btn => {
          btn.classList.remove('active');
        });
        document.getElementById(`btn-${type}`).classList.add('active');

        // æ›´æ–°å½“å‰æ¨¡å¼æ˜¾ç¤º
        const modeNames = {
          0: 'é€‰æ‹©æ¨¡å¼', 1: 'çŸ©å½¢', 2: 'å¤šè¾¹å½¢', 3: 'ç‚¹æ ‡æ³¨',
          4: 'æŠ˜çº¿', 5: 'åœ†å½¢', 6: 'ç½‘æ ¼', 7: 'ç”»ç¬”', 8: 'æ©¡çš®æ“¦'
        };
        document.getElementById('currentMode').textContent = modeNames[type];

        addEventLog('åˆ‡æ¢åˆ›å»ºæ¨¡å¼', { mode: modeNames[type] });
      }

      // ç¼©æ”¾æ§åˆ¶
      function zoomIn() {
        instance.setScale(true);
        addEventLog('æ”¾å¤§ç”»å¸ƒ', {});
      }

      function zoomOut() {
        instance.setScale(false);
        addEventLog('ç¼©å°ç”»å¸ƒ', {});
      }

      function fitZoom() {
        instance.fitZoom();
        addEventLog('é€‚é…ç”»å¸ƒ', {});
      }

      function toggleFocusMode() {
        instance.setFocusMode(!instance.focusMode);
        addEventLog('åˆ‡æ¢ä¸“æ³¨æ¨¡å¼', { enabled: instance.focusMode });
        updateUI();
      }

      // åˆ‡æ¢åŠŸèƒ½
      function toggleCross() {
        instance.showCross = document.getElementById('showCross').checked;
        instance.update();
        addEventLog('åˆ‡æ¢åå­—åæ ‡çº¿', { enabled: instance.showCross });
      }

      function toggleScrollZoom() {
        instance.scrollZoom = document.getElementById('scrollZoom').checked;
        addEventLog('åˆ‡æ¢æ»šè½®ç¼©æ”¾', { enabled: instance.scrollZoom });
      }

      function toggleReadonly() {
        instance.readonly = document.getElementById('readonly').checked;
        addEventLog('åˆ‡æ¢åªè¯»æ¨¡å¼', { enabled: instance.readonly });
      }

      function toggleLock() {
        instance.lock = document.getElementById('lock').checked;
        addEventLog('åˆ‡æ¢é”å®šæ¨¡å¼', { enabled: instance.lock });
      }

      function toggleShowRotation() {
        instance.showRotation = document.getElementById('showRotation').checked;
        instance.update();
        addEventLog('åˆ‡æ¢æ—‹è½¬æ§åˆ¶', { enabled: instance.showRotation });
      }

      // æ ·å¼æ›´æ–°
      function updateStyle() {
        instance.strokeStyle = document.getElementById('strokeStyle').value;
        instance.fillStyle = document.getElementById('fillStyle').value + '40'; // æ·»åŠ é€æ˜åº¦
        instance.lineWidth = parseInt(document.getElementById('lineWidth').value);
        instance.ctrlRadius = parseInt(document.getElementById('ctrlRadius').value);

        document.getElementById('lineWidthValue').textContent = instance.lineWidth;
        document.getElementById('ctrlRadiusValue').textContent = instance.ctrlRadius;

        instance.update();
        addEventLog('æ›´æ–°æ ·å¼', {
          strokeStyle: instance.strokeStyle,
          lineWidth: instance.lineWidth
        });
      }

      function updateBrushStyle() {
        instance.brushStokeStyle = document.getElementById('brushColor').value;
        instance.brushSize = parseInt(document.getElementById('brushSize').value);

        document.getElementById('brushSizeValue').textContent = instance.brushSize;

        addEventLog('æ›´æ–°ç”»ç¬”æ ·å¼', {
          color: instance.brushStokeStyle,
          size: instance.brushSize
        });
      }

      function updateEraserStyle() {
        instance.eraserSize = parseInt(document.getElementById('eraserSize').value);
        document.getElementById('eraserSizeValue').textContent = instance.eraserSize;

        addEventLog('æ›´æ–°æ©¡çš®æ“¦å¤§å°', { size: instance.eraserSize });
      }

      function updateLabelStyle() {
        instance.labelFont = document.getElementById('labelFont').value;
        instance.labelFillStyle = document.getElementById('labelFillStyle').value;
        instance.textFillStyle = document.getElementById('textFillStyle').value;
        instance.hideLabel = document.getElementById('hideLabel').checked;
        instance.labelUp = document.getElementById('labelUp').checked;

        instance.update();
        addEventLog('æ›´æ–°æ ‡ç­¾æ ·å¼', {
          font: instance.labelFont,
          hideLabel: instance.hideLabel
        });
      }

      // æ•°æ®æ“ä½œ
      function loadSampleData() {
        const sampleData = [
          {
            label: "ç¤ºä¾‹çŸ©å½¢",
            coor: [[100, 100], [200, 150]],
            type: 1,
            strokeStyle: "#ff0000",
            fillStyle: "rgba(255, 0, 0, 0.2)"
          },
          {
            label: "ç¤ºä¾‹å¤šè¾¹å½¢",
            coor: [[250, 120], [280, 100], [320, 130], [300, 170], [260, 160]],
            type: 2,
            strokeStyle: "#00ff00",
            fillStyle: "rgba(0, 255, 0, 0.2)"
          },
          {
            label: "ç¤ºä¾‹ç‚¹",
            coor: [350, 200],
            type: 3,
            strokeStyle: "#0000ff"
          },
          {
            label: "ç¤ºä¾‹æŠ˜çº¿",
            coor: [[400, 100], [450, 120], [480, 90], [520, 110]],
            type: 4,
            strokeStyle: "#ff00ff"
          },
          {
            label: "ç¤ºä¾‹åœ†å½¢",
            coor: [150, 250],
            radius: 40,
            type: 5,
            strokeStyle: "#ffff00",
            fillStyle: "rgba(255, 255, 0, 0.2)"
          },
          {
            label: "ç¤ºä¾‹ç½‘æ ¼",
            coor: [[300, 250], [400, 320]],
            type: 6,
            row: 3,
            col: 2,
            selected: [1, 3],
            strokeStyle: "#00ffff"
          }
        ];

        instance.setData(sampleData);
        addEventLog('åŠ è½½ç¤ºä¾‹æ•°æ®', { count: sampleData.length });
        showToast('ç¤ºä¾‹æ•°æ®åŠ è½½å®Œæˆï¼', 'success');
      }

      function clearAllData() {
        if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ ‡æ³¨æ•°æ®å—ï¼Ÿ')) {
          instance.setData([]);
          addEventLog('æ¸…ç©ºæ‰€æœ‰æ•°æ®', {});
          showToast('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼', 'success');
        }
      }

      function exportData() {
        const data = JSON.stringify(instance.dataset, null, 2);
        const blob = new Blob([data], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `canvas-select-data-${new Date().getTime()}.json`;
        a.click();
        URL.revokeObjectURL(url);

        addEventLog('å¯¼å‡ºæ•°æ®', { count: instance.dataset.length });
        showToast('æ•°æ®å¯¼å‡ºå®Œæˆï¼', 'success');
      }

      function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        input.onchange = (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const data = JSON.parse(e.target.result);
                instance.setData(data);
                addEventLog('å¯¼å…¥æ•°æ®', { count: data.length });
                showToast('æ•°æ®å¯¼å…¥å®Œæˆï¼', 'success');
              } catch (error) {
                showToast('æ•°æ®æ ¼å¼é”™è¯¯ï¼', 'error');
              }
            };
            reader.readAsText(file);
          }
        };
        input.click();
      }

      function deleteSelected() {
        const activeShape = instance.activeShape;
        if (activeShape && activeShape.index !== undefined) {
          instance.deleteByIndex(activeShape.index);
          showToast('å·²åˆ é™¤é€‰ä¸­æ ‡æ³¨ï¼', 'success');
        } else {
          showToast('è¯·å…ˆé€‰ä¸­è¦åˆ é™¤çš„æ ‡æ³¨ï¼', 'warning');
        }
      }

      function clearBrush() {
        instance.clearBrush();
        addEventLog('æ¸…é™¤ç”»ç¬”æ•°æ®', {});
        showToast('ç”»ç¬”æ•°æ®å·²æ¸…é™¤ï¼', 'success');
      }

      // å›¾ç‰‡æ“ä½œ
      function changeImage() {
        const url = document.getElementById('imageUrl').value;
        if (url) {
          instance.setImage(url);
          addEventLog('æ›´æ¢å›¾ç‰‡', { url });
        } else {
          showToast('è¯·è¾“å…¥å›¾ç‰‡URLï¼', 'warning');
        }
      }

      function loadLocalImage() {
        document.getElementById('fileInput').click();
      }

      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file && file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
              instance.setImage(img);
              addEventLog('åŠ è½½æœ¬åœ°å›¾ç‰‡', { name: file.name });
              showToast('æœ¬åœ°å›¾ç‰‡åŠ è½½å®Œæˆï¼', 'success');
            };
            img.src = e.target.result;
          };
          reader.readAsDataURL(file);
        } else {
          showToast('è¯·é€‰æ‹©æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼', 'error');
        }
      }

      // UIæ›´æ–°å‡½æ•°
      function updateUI() {
        updateScaleInfo();
        updateShapeCount(instance.dataset.length);

        // æ›´æ–°åˆ›å»ºç±»å‹æŒ‰é’®çŠ¶æ€
        setCreateType(instance.createType);

        // æ›´æ–°å¤é€‰æ¡†çŠ¶æ€
        document.getElementById('showCross').checked = instance.showCross;
        document.getElementById('scrollZoom').checked = instance.scrollZoom;
        document.getElementById('readonly').checked = instance.readonly;
        document.getElementById('lock').checked = instance.lock;
        document.getElementById('showRotation').checked = instance.showRotation;
        document.getElementById('hideLabel').checked = instance.hideLabel;
        document.getElementById('labelUp').checked = instance.labelUp;
      }

      function updateScaleInfo() {
        const scale = Math.round(instance.scale * 100);
        document.getElementById('scaleInfo').textContent = `${scale}%`;
      }

      function updateShapeCount(count) {
        document.getElementById('shapeCount').textContent = count;
      }

      function updateDataOutput(data) {
        const output = document.getElementById('dataOutput');
        if (data && data.length > 0) {
          output.textContent = JSON.stringify(data, null, 2);
        } else {
          output.textContent = 'æš‚æ— æ ‡æ³¨æ•°æ®';
        }
      }

      // äº‹ä»¶æ—¥å¿—
      function addEventLog(event, data) {
        const timestamp = new Date().toLocaleTimeString();
        eventLog.unshift({ timestamp, event, data });

        if (eventLog.length > maxLogItems) {
          eventLog = eventLog.slice(0, maxLogItems);
        }

        updateEventLogDisplay();
      }

      function updateEventLogDisplay() {
        const logContainer = document.getElementById('eventLog');
        logContainer.innerHTML = eventLog.map(log =>
          `<div class="event-item">
          <strong>${log.timestamp}</strong> - ${log.event}
          ${Object.keys(log.data).length > 0 ?
            `<br><small>${JSON.stringify(log.data)}</small>` : ''}
        </div>`
        ).join('');
      }

      // å·¥å…·å‡½æ•°
      function getShapeTypeName(type) {
        const typeNames = {
          1: 'çŸ©å½¢', 2: 'å¤šè¾¹å½¢', 3: 'ç‚¹', 4: 'æŠ˜çº¿',
          5: 'åœ†å½¢', 6: 'ç½‘æ ¼', 7: 'ç”»ç¬”', 8: 'æ©¡çš®æ“¦'
        };
        return typeNames[type] || 'æœªçŸ¥';
      }

      function showToast(message, type = 'success') {
        console.info('::canvas-selectäº‹ä»¶', message);
      }

      // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', init);

      // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è°ƒæ•´
      window.addEventListener('resize', () => {
        if (instance) {
          instance.resize();
        }
      });
    </script>
    <!-- ä»¥ä¸‹æ˜¯æ€§èƒ½æ£€æµ‹è„šæœ¬-->
    <!-- <script src="https://unpkg.com/stats.js@0.17.0/build/stats.min.js"> </script>
    <script>
      const stats = new Stats();
      // stats.showPanel(2); // 0: fps, 1: ms, 2: mb, 3+: custom
      document.body.appendChild(stats.dom);
      function animate() {
        stats.begin();
        // monitored code goes here
        stats.end();
        requestAnimationFrame(animate);
      }
      requestAnimationFrame(animate);
    </script> -->
</body>

</html>
